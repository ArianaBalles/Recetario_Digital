<!DOCTYPE html>
<html lang="es">  
<head>    
    <title>Recetario Digital | Prueba Técnica</title>    
    <meta charset="UTF-8">
    <meta name="title" content="Recetario digital">
    <meta name="description" content="Descripción de la WEB">    
    <link href="css/bootstrap.css" rel="stylesheet">

    <script src="js/bootstrap.js"></script>  
    <script type="text/javascript">
        /* Código JS */
    </script> 
</head>  
<body>  
    <div>
        <header>
            <nav class="navbar navbar-expand-lg principal navbar-dark">
                <div class="container">
                    <a class="navbar-brand textologo" href="#">
                        <img class="imglogo" src="img/logo_recetario.png" alt="Logo">
                        Recetario Digital
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item"><a class="nav-link" href="login.html">Cerrar Sesión</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <div class="txtbienvenida">
            <h1>Recetario Digital</h1>      
        </div>    
        <div class="container">
            <div class="row">
                <div class="col descripcion">
                    Este lugar esta especialmente diseñado para los amantes de la cocina, te compatiremos una gran cantidad de recetas practicas  y deliciosas para degustar en familia o en reuniones. ¡Te acompañaremos paso a paso para la elección de tu platillo perfecto para la ocación!
                </div>
            </div>
            
            <section>      
                <p class="textosecundario">NUESTRAS OPCIONES</p>
              
                <div class="container">
                    <div class="row">
                        <!-- Buscador de Platillos -->
                        <div class="col-12 col-md-6">
                            <p class="textopciones">Buscar Platillo (por nombre, ingrediente o tag)</p>
                            <input type="text" class="form-control" id="buscarPlatillo" placeholder="Escribe aquí..." onkeyup="buscarPlatillo()">
                        </div>
                        <!-- Filtro por Categorías -->
                        <div class="col-12 col-md-6">
                            <p class="textopciones">Filtrar por Categoría</p>
                            <select class="form-select" id="categoriaFiltro" onchange="filtrarPorCategoria()">
                                <option value="todos">Todas las categorías</option>
                                <option value="entradas">Entradas</option>
                                <option value="platos-principales">Platos principales</option>
                                <option value="postres">Postres</option>
                                <option value="bebidas">Bebidas</option>
                            </select>
                        </div>
                    </div>
            <br>
                   <!-- FILTRADO DE CATEGORIAS -->
                    <div class="row resultados-container descripcion" id="resultados"></div>
                    <br>

                    <!-- Sección de Favoritos -->
                    <div class="favoritos-container">
                        <p class="textosecundario">MIS FAVORITOS</p>
                        <ul id="favoritosLista" class="list-group">
                            <!-- Favoritos aparecerán aquí -->
                        </ul>
                    </div>
                </div>
            
                <script>
                    let favoritos = [];
            
                    // Función para agregar un platillo a los favoritos
                    function agregarFavorito(nombre, categoria) {
                        // Verifica si el platillo ya está en los favoritos
                        let favorito = { nombre: nombre, categoria: categoria };
                        if (!favoritos.some(item => item.nombre === nombre)) {
                            favoritos.push(favorito);
                            mostrarFavoritos();
                        } else {
                            alert("Este platillo ya está en tus favoritos.");
                        }
                    }
            
                    // Mostrar los favoritos en la lista
                    function mostrarFavoritos() {
                        let listaFavoritos = document.getElementById("favoritosLista");
                        listaFavoritos.innerHTML = "";  // Limpiar la lista actual
                        favoritos.forEach(item => {
                            let li = document.createElement("li");
                            li.classList.add("list-group-item");
                            li.textContent = `${item.nombre}`;
                            listaFavoritos.appendChild(li);
                        });
                    }
            
                    // FUNCION PARA FILTRO DE LAS CATEGORIAS
                    document.addEventListener("DOMContentLoaded", async () => {
                    await cargarCategorias();
                    await cargarPlatillos();
                });

                async function cargarCategorias() {
                    try {
                        let res = await fetch("https://www.themealdb.com/api/json/v1/1/categories.php");
                        let data = await res.json();
                        let select = document.getElementById("categoriaFiltro");
                        select.innerHTML = '<option value="todos">Todas las categorías</option>' +
                            data.categories.map(c => `<option value="${c.strCategory.toLowerCase()}"">${c.strCategory}</option>`).join('');
                    } catch (error) { console.error("Error: ", error); }
                }

                async function cargarPlatillos(categoria = "Seafood") {
                    try {
                        let res = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?c=${categoria}`);
                        let data = await res.json();
                        mostrarPlatillos(data.meals);
                    } catch (error) { console.error("Error: ", error); }
                }

                function mostrarPlatillos(platillos) {
                    document.getElementById("resultados").innerHTML = platillos.map(meal => `
                        <div class="col-6 col-md-2">
                            <div class="card" data-categoria="${meal.strCategory ? meal.strCategory.toLowerCase() : 'otros'}" data-nombre="${meal.strMeal.toLowerCase()}">
                                <img src="${meal.strMealThumb}" class="card-img-top" alt="${meal.strMeal}" style="height: 100px; object-fit: cover;">
                                <div class="card-body" style="padding: 10px; text-align: center;">
                                    <h6 class="card-title" style="font-size: 0.9rem;">${meal.strMeal}</h6>
                                    <div class="d-flex justify-content-center">
                                        <button class="btn btn-info btn-sm me-2" onclick="verDetalle(${meal.idMeal})">Ver</button>
                                        <button class="btn btn-favorito btn-sm" onclick="agregarFavorito('${meal.strMeal}', '${meal.strCategory}')">❤</button>
                                    </div>
                                </div>
                            </div>
                        </div>`).join('');
                }

                // Función para redirigir al detalle del platillo
                function verDetalle(idMeal) {
                    window.location.href = `detalle.html?id=${idMeal}`;
                }



                function filtrarPorCategoria() {
                    let categoria = document.getElementById("categoriaFiltro").value;
                    cargarPlatillos(categoria === "todos" ? "Seafood" : categoria);
                }

                async function buscarPlatillo() {
                    let input = document.getElementById("buscarPlatillo").value.toLowerCase();
                    if (input.length === 0) {
                        filtrarPorCategoria();
                        return;
                    }
                    try {
                        let res = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${input}`);
                        let data = await res.json();
                        if (data.meals) {
                            mostrarPlatillos(data.meals);
                        } else {
                            document.getElementById("resultados").innerHTML = "<p>No se encontraron resultados.</p>";
                        }
                    } catch (error) { console.error("Error: ", error); }
                }


                    


            
                    // FUNCION DE BUSCAR PALTILLO POR NOMBRE
                    async function buscarPlatillo() {
                    let input = document.getElementById("buscarPlatillo").value.trim().toLowerCase();
                    if (input.length === 0) {
                        filtrarPorCategoria(); // Si está vacío, carga la categoría seleccionada
                        return;
                    }

                    try {
                        let resultados = [];

                        // Buscar por nombre
                        let resNombre = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${input}`);
                        let dataNombre = await resNombre.json();
                        if (dataNombre.meals) {
                            resultados = [...dataNombre.meals];
                        }

                        // Buscar por ingrediente
                        let resIngrediente = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?i=${input}`);
                        let dataIngrediente = await resIngrediente.json();
                        if (dataIngrediente.meals) {
                            resultados = [...resultados, ...dataIngrediente.meals];
                        }

                        // Buscar por categoría (tags)
                        let resCategoria = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?c=${input}`);
                        let dataCategoria = await resCategoria.json();
                        if (dataCategoria.meals) {
                            resultados = [...resultados, ...dataCategoria.meals];
                        }

                        // Eliminar duplicados
                        let resultadosUnicos = [];
                        let ids = new Set();

                        resultados.forEach(meal => {
                            if (!ids.has(meal.idMeal)) {
                                ids.add(meal.idMeal);
                                resultadosUnicos.push(meal);
                            }
                        });

                        // Mostrar resultados
                        if (resultadosUnicos.length > 0) {
                            mostrarPlatillos(resultadosUnicos);
                        } else {
                            document.getElementById("resultados").innerHTML = "<p>No se encontraron resultados.</p>";
                        }

                    } catch (error) {
                        console.error("Error al buscar platillo:", error);
                    }
                }

                
                </script>

            </section>
        </div>
        <br>
        <br>
        <br>
        <br>
        
        <footer class="footer">
            <div class="container">
            </div>
        </footer>
</div> 

</body>  
</html>